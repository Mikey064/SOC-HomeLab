# Day 11: How to create alerts and dashboards in Kibana

## Objective



### Skills Learned


- Advanced understanding of SIEM concepts and practical application.
- Proficiency in analyzing and interpreting logs.
- Ability to recognize brute-force attack patterns.
- Ability to create vsualizations and dashboards in a SIEM.


### Tools Used

- Security Information and Event Management (SIEM) system for log ingestion and analysis.
- Telemetry generation tools to create attack scenarios.

## Steps
- We login to Kibana, click on the hamburger icon on the top-left and select Discover. We should already have some data ingested and if not try to refresh your instance or check the status of your policies in Fleets.

![logsearch](https://github.com/user-attachments/assets/4646441b-7468-4b8a-a518-45ee7d42ab86)
            *Ref 1: Go to the Discover page*
  
- The Discover page already has some logs on display but we need to find the logs specific to the event we are investigating.

![log page](https://github.com/user-attachments/assets/1d600a59-45a9-4819-be4c-fea49a70b04c)
            *Ref 2: Discover page*

- Since we ae looking logs that originated from the Ubuntu VM, we'll filter for it by clicking on `agent.name filer` and selecting `ubuntu-vm`  (as it is in my own setup). Click on the plus (+) icon in front of ubuntu vm to apply the filter.

![filterubuntu](https://github.com/user-attachments/assets/744a1ef9-128b-4fcf-b0c1-9a408a4aa4dc)
            *Ref 3: Apply filter to select logs from Ubuntu server*

- Once the filter has been applied, you'll see the number of events (13K +) generated by the ssh server. This is a lot of logs go over individually so we apply more filter to find SSH activities.
- To find a brute-force attack, one of the key things to look for is failed authentications because a brut-force is trying a lot of combinations to gain unauthorized access into our account. Other keywords we'll be looking out for asides failed attempts is; user, source ip. Let's start with `failed` attempts. 
- We got some results but not quite what we are looking as some of the messages are rather informational and have nothing to do with brute-forcing, so we keep checking. Scrolling down and Clicking on several filters on the left side of the page until we find `system.auth.ssh.event` which is what we need.
- This filter has three SSH events listed (Accepted, Failed, Invalid). So we select it by clicking on its plus icon (not the icon in front of the other options). The filter works but there is no message on display to prove there was any brute-force meanwhile we actually know for a fact that there was an SSH attack.
- To find the proof we need, we go to he search bar and type `system.auth.ssh.event` and chose the option that says `exists in any form (*)`. 
- Now we have over 2k+ events and a lot of `Failed` messages. We continue to find more by scrolling down the left to find usernames, authentication method used etc. 
- The authentication method shows that the most used form of authentication is `password` which is mostly informational.
- The username filter lists a lot of options and this will be added by clicking the plus sign in front of it which adds the field to a column.
- Next, we try to find the source IP where all the attacks generated. By clicking and adding `source.ip`to a column.
- To highlight for only failed attempts to be displayed, we select a box showing `failed` and click the plus icon in front of it.
- Now we can build our dashboard but first we need to save our search. Click  on the save button at the top right corner, name the file and save it.
- To create an Alert, Click on Alert at the top-right corner and select `Create Threshold rule` . Name your alert accordingly. The rule can be adjusted to fit your functionality by choosing the maximum counts it would take to trigger an alert, the timeframe etc. You can test the query to check it's functionality.
- Tried testing for he past 5 days and I got a result showing the number of SSH brute-force events occurred in the past 5 days. This confirms that the query works. Then save the alert.

### Creating a Dashboard
Now we want to visualize all the data we have obtained  
- We click on the hamburger icon if you notice, you'll probably see the search we saved earlier. The focus is here is to locate the `Dashboard` and select it.
- There will some options for us to choose from. There was a `SSH Login Attempts` dashboard already created by Kibana however, it's best for us to make our own. Click on `Create Dashboard` and then select `Create Visualization`
- Before we proceed, head back to discover and copy out the query used earlier. This would make things faster instead of having to go over the process again using the query; `system.auth.ssh.event : * and agent.name: ubuntu-vm and system.auth.ssh.event:Â Failed `. Run it once more to confirm and remove all filters.
- Back to Dashboard, you can create a visualization by selecting  filter and left and dropping it on the space in the center of the screen. I selected `system.ssh.auth.event`, click save and return.
- We keep adding some more visualizations to the board by creating visualizations for a specific dataset. 
- When you have customized the visualizations as much as you want, you can proceed to save the dashboard.



*Ref 1: Network Diagram*
